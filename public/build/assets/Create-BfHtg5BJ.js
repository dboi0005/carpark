import{C as te,D as se,z as c,c as v,o as m,w as t,a as s,f as d,b as a,_ as ae,q as x,u as oe,j as F,y as L,M as ne,g as q,t as p,E as le,G as de,i as b,F as ie,K as re,d as l,J as N,A as D,I as ue}from"./app-NUBUC0vD.js";import{H as ce}from"./html5-qrcode-scanner-BZty-w_P.js";const me={__name:"QrScanner",props:te({closeScanner:Function},{modelValue:{type:Boolean,default:!1},modelModifiers:{}}),emits:["update:modelValue"],setup(R){const y=se(R,"modelValue");return(V,n)=>{const w=c("v-card-title"),k=c("v-card-text"),h=c("v-btn"),f=c("v-card-actions"),o=c("v-card"),A=c("v-dialog");return m(),v(A,{modelValue:y.value,"onUpdate:modelValue":n[0]||(n[0]=E=>y.value=E),"max-width":"600"},{default:t(()=>[s(o,null,{default:t(()=>[s(w,null,{default:t(()=>[...n[1]||(n[1]=[d("Scan QR Code",-1)])]),_:1}),s(k,null,{default:t(()=>[...n[2]||(n[2]=[a("div",{id:"reader",style:{width:"100%",height:"400px"}},null,-1)])]),_:1}),s(f,null,{default:t(()=>[s(h,{color:"error",text:"",onClick:R.closeScanner},{default:t(()=>[...n[3]||(n[3]=[d("Close",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1})]),_:1},8,["modelValue"])}}},pe={class:"payment-wrapper"},ve={class:"page-header mb-6 text-center"},fe={class:"card-header pa-6 pb-4"},_e={class:"d-flex align-center justify-space-between"},ge={class:"text-h6 font-weight-bold text-indigo-darken-4"},be={class:"pa-6"},ye={class:"search-section mb-4"},he={class:"text-caption"},xe={class:"divider-section mb-4"},we={class:"cards-list-section"},ke={class:"d-flex align-center justify-space-between mb-3"},Ce={key:0,class:"cards-container"},Ve={class:"pa-4 d-flex align-center justify-space-between"},ze={class:"d-flex align-center flex-grow-1"},Se={class:"text-subtitle-2 font-weight-bold"},Ge={class:"text-caption text-medium-emphasis"},Ne={class:"price-section mr-3"},Re={class:"text-h6 font-weight-bold text-indigo-darken-4"},Ae={class:"total-section pa-6 pb-4"},Ee={class:"pa-4 d-flex align-center justify-space-between"},Pe={class:"d-flex align-center"},Qe={class:"text-h5 font-weight-bold text-indigo-darken-4 mb-0"},Ue={class:"payment-form-section pa-6 pt-0"},je={class:"input-group mb-4"},qe={class:"input-label"},Te={class:"d-flex align-center justify-space-between"},Be={class:"text-h6 font-weight-bold"},Me={class:"d-flex align-center"},Fe={class:"d-flex align-center justify-space-between"},Le={class:"text-subtitle-2 font-weight-bold"},De={class:"action-buttons pa-6"},Ie={__name:"Create",props:{cardTemplate:Array,scannedCards:Array},setup(R){const y=x(null),V=x([]),n=x([]),w=x(!1),k=x(""),h=x(!1),f=x(null),o=oe({customer:"",cash_amount:null,payment_method:"Cash",Gcash_reference:"",cards:[]}),A=F(()=>{const i=n.value.length===0||!o.cash_amount||!o.customer||o.cash_amount<_.value;return o.payment_method==="Gcash"?i||!o.Gcash_reference:i});function E(i,e=300){let r;return function(...C){clearTimeout(r),r=setTimeout(()=>i.apply(this,C),e)}}const I=E(i=>{if(!i){V.value=[],w.value=!1;return}w.value=!0,ue.get(N("card.inventory.search"),{params:{q:i}}).then(e=>{V.value=e.data}).finally(()=>{w.value=!1})},300);L(k,i=>{I(i)});const _=F(()=>n.value.reduce((i,e)=>i+Number(e.price||0),0));L(y,i=>{if(i){const e=V.value.find(r=>r.id===i);e&&(n.value.some(C=>C.id===e.id)||(n.value.push(e),y.value=null,k.value=""))}});const $=async()=>{h.value=!0,setTimeout(H,300)},H=async()=>{if(h.value)try{f.value=new ce("reader"),await f.value.start({facingMode:"environment"},{fps:10,qrbox:{width:250,height:250}},async i=>{await P(),D.post(N("scan.qr.cards"),{qr_code:i,is_sell_card:!0},{onSuccess:e=>{n.value.push(e.props.scannedCards)},onError:e=>{console.error("Failed to add card:",e)}})})}catch(i){console.error("Error starting camera:",i.message)}},P=async()=>{if(f.value){try{await f.value.stop(),await f.value.clear()}catch(i){console.error("Error closing scanner:",i)}f.value=null}h.value=!1},J=i=>{n.value=n.value.filter(e=>e.id!==i)},K=()=>{n.value=[]},O=()=>{o.cards=n.value.map(i=>i.id),o.post(N("sell-card.payment"),{onSuccess:()=>{n.value=[],o.reset()}})},W=()=>{D.get(N("parkin.index"))};return ne(()=>{P()}),(i,e)=>{const r=c("v-icon"),C=c("v-chip"),z=c("v-divider"),T=c("v-avatar"),X=c("v-list-item"),Y=c("v-autocomplete"),g=c("v-btn"),G=c("v-card"),S=c("v-expand-transition"),Z=c("v-btn-toggle"),Q=c("v-text-field"),U=c("v-alert"),j=c("v-col"),B=c("v-row"),ee=c("v-container");return m(),q("div",pe,[s(me,{modelValue:h.value,"onUpdate:modelValue":e[0]||(e[0]=u=>h.value=u),closeScanner:P},null,8,["modelValue"]),s(ee,{fluid:"",class:"py-8"},{default:t(()=>[s(B,{justify:"center"},{default:t(()=>[s(j,{cols:"12",md:"8",lg:"6"},{default:t(()=>[a("div",ve,[s(r,{size:"48",color:"white",class:"mb-2"},{default:t(()=>[...e[8]||(e[8]=[d("mdi-cash-register",-1)])]),_:1}),e[9]||(e[9]=a("h1",{class:"text-h4 font-weight-bold text-white mb-2"}," Card Payment ",-1)),e[10]||(e[10]=a("p",{class:"text-white-70"}," Scan or search for cards to process payment ",-1))]),s(G,{class:"payment-card elevation-12",rounded:"xl"},{default:t(()=>[a("div",fe,[a("div",_e,[a("h3",ge,[s(r,{class:"mr-2"},{default:t(()=>[...e[11]||(e[11]=[d("mdi-credit-card-search",-1)])]),_:1}),e[12]||(e[12]=d(" Select Cards ",-1))]),s(C,{color:"indigo-darken-4",variant:"flat",size:"small"},{default:t(()=>[d(p(n.value.length)+" item"+p(n.value.length!==1?"s":""),1)]),_:1})])]),s(z),a("div",be,[a("div",ye,[s(Y,{modelValue:y.value,"onUpdate:modelValue":e[1]||(e[1]=u=>y.value=u),search:k.value,"onUpdate:search":e[2]||(e[2]=u=>k.value=u),items:V.value,"item-title":"card_number","item-value":"id",label:"Search Card Number",density:"comfortable",loading:w.value,"hide-no-data":"","hide-details":"",variant:"outlined","bg-color":"white","prepend-inner-icon":"mdi-magnify",clearable:"",class:"search-input"},{item:t(({props:u,item:M})=>[s(X,le(de(u)),{prepend:t(()=>[s(T,{color:"indigo-lighten-5",size:"36"},{default:t(()=>[s(r,{size:"20",color:"indigo-darken-4"},{default:t(()=>[...e[13]||(e[13]=[d("mdi-card-account-details",-1)])]),_:1})]),_:1})]),subtitle:t(()=>[a("span",he,p(M.raw.card_name),1)]),_:2},1040)]),_:1},8,["modelValue","search","items","loading"])]),a("div",xe,[s(z),e[14]||(e[14]=a("span",{class:"divider-text"},"OR",-1)),s(z)]),s(g,{class:"mb-6 scan-btn",color:"indigo-darken-4",block:"",size:"x-large",variant:"flat",onClick:$},{default:t(()=>[s(r,{class:"mr-2",size:"24"},{default:t(()=>[...e[15]||(e[15]=[d("mdi-qrcode-scan",-1)])]),_:1}),e[16]||(e[16]=a("span",{class:"text-h6 font-weight-bold"},"Scan QR Code",-1))]),_:1}),a("div",we,[a("div",ke,[e[19]||(e[19]=a("h4",{class:"text-subtitle-1 font-weight-bold text-indigo-darken-4"}," Selected Cards ",-1)),n.value.length>0?(m(),v(g,{key:0,size:"small",color:"error",variant:"text",onClick:K},{default:t(()=>[s(r,{start:"",size:"18"},{default:t(()=>[...e[17]||(e[17]=[d("mdi-delete-sweep",-1)])]),_:1}),e[18]||(e[18]=d(" Clear All ",-1))]),_:1})):b("",!0)]),s(S,null,{default:t(()=>[n.value.length?(m(),q("div",Ce,[(m(!0),q(ie,null,re(n.value,u=>(m(),v(G,{key:u.id,class:"card-item elevation-2 mb-3",rounded:"lg"},{default:t(()=>[a("div",Ve,[a("div",ze,[s(T,{color:"indigo-lighten-5",size:"48",class:"mr-3"},{default:t(()=>[s(r,{size:"28",color:"indigo-darken-4"},{default:t(()=>[...e[20]||(e[20]=[d("mdi-qrcode",-1)])]),_:1})]),_:1}),a("div",null,[a("div",Se,p(u.card_number),1),a("div",Ge,p(u.card_name),1)])]),a("div",Ne,[a("div",Re," ₱"+p(Number(u.price).toLocaleString()),1)]),s(g,{icon:"",size:"small",color:"error",variant:"text",onClick:M=>J(u.id)},{default:t(()=>[s(r,{size:"20"},{default:t(()=>[...e[21]||(e[21]=[d("mdi-close-circle",-1)])]),_:1})]),_:2},1032,["onClick"])])]),_:2},1024))),128))])):b("",!0)]),_:1}),n.value.length?b("",!0):(m(),v(G,{key:0,class:"empty-state pa-8 text-center",flat:"",color:"grey-lighten-4",rounded:"lg"},{default:t(()=>[s(r,{size:"64",color:"grey-lighten-1",class:"mb-3"},{default:t(()=>[...e[22]||(e[22]=[d(" mdi-credit-card-off-outline ",-1)])]),_:1}),e[23]||(e[23]=a("p",{class:"text-body-2 text-medium-emphasis mb-0"}," No cards selected yet ",-1)),e[24]||(e[24]=a("p",{class:"text-caption text-medium-emphasis"}," Search or scan a QR code to add cards ",-1))]),_:1}))])]),s(z),a("div",Ae,[s(G,{class:"total-card elevation-0",color:"indigo-lighten-5",rounded:"lg"},{default:t(()=>[a("div",Ee,[a("div",Pe,[s(r,{size:"32",color:"indigo-darken-4",class:"mr-3"},{default:t(()=>[...e[25]||(e[25]=[d(" mdi-calculator ",-1)])]),_:1}),a("div",null,[e[26]||(e[26]=a("p",{class:"text-caption text-medium-emphasis mb-0"},"Total Amount",-1)),a("p",Qe," ₱"+p(_.value.toLocaleString()),1)])]),n.value.length>0?(m(),v(C,{key:0,color:"success",variant:"flat",size:"small"},{default:t(()=>[s(r,{start:"",size:"12"},{default:t(()=>[...e[27]||(e[27]=[d("mdi-check",-1)])]),_:1}),e[28]||(e[28]=d(" Ready ",-1))]),_:1})):b("",!0)])]),_:1})]),a("div",Ue,[e[40]||(e[40]=a("h4",{class:"text-subtitle-1 font-weight-bold text-indigo-darken-4 mb-4"}," Payment Details ",-1)),a("div",je,[a("label",qe,[s(r,{size:"18",class:"mr-1"},{default:t(()=>[...e[29]||(e[29]=[d("mdi-wallet",-1)])]),_:1}),e[30]||(e[30]=d(" Payment Method ",-1))]),s(Z,{modelValue:l(o).payment_method,"onUpdate:modelValue":e[3]||(e[3]=u=>l(o).payment_method=u),color:"indigo-darken-4",variant:"outlined",divided:"",mandatory:"",class:"payment-method-toggle"},{default:t(()=>[s(g,{value:"cash",class:"payment-method-btn"},{default:t(()=>[s(r,{start:""},{default:t(()=>[...e[31]||(e[31]=[d("mdi-cash",-1)])]),_:1}),e[32]||(e[32]=d(" Cash ",-1))]),_:1}),s(g,{value:"Gcash",class:"payment-method-btn"},{default:t(()=>[s(r,{start:""},{default:t(()=>[...e[33]||(e[33]=[d("mdi-cellphone",-1)])]),_:1}),e[34]||(e[34]=d(" GCash ",-1))]),_:1})]),_:1},8,["modelValue"])]),s(Q,{modelValue:l(o).cash_amount,"onUpdate:modelValue":e[5]||(e[5]=u=>l(o).cash_amount=u),label:l(o).payment_method==="Gcash"?"GCash Amount":"Cash Amount",type:"number",variant:"outlined",density:"comfortable","prepend-inner-icon":l(o).payment_method==="Gcash"?"mdi-cellphone":"mdi-cash",prefix:"₱","hide-details":"auto","error-messages":l(o).errors.cash_amount,class:"mb-4"},{"append-inner":t(()=>[s(g,{size:"small",variant:"text",color:"indigo-darken-4",onClick:e[4]||(e[4]=u=>l(o).cash_amount=_.value)},{default:t(()=>[...e[35]||(e[35]=[d(" Exact ",-1)])]),_:1})]),_:1},8,["modelValue","label","prepend-inner-icon","error-messages"]),s(S,null,{default:t(()=>[l(o).payment_method==="Gcash"?(m(),v(Q,{key:0,modelValue:l(o).Gcash_reference,"onUpdate:modelValue":e[6]||(e[6]=u=>l(o).Gcash_reference=u),label:"GCash Reference Number",variant:"outlined",density:"comfortable","prepend-inner-icon":"mdi-pound","hide-details":"auto","error-messages":l(o).errors.Gcash_reference,class:"mb-4",placeholder:"Enter reference number"},null,8,["modelValue","error-messages"])):b("",!0)]),_:1}),s(Q,{modelValue:l(o).customer,"onUpdate:modelValue":e[7]||(e[7]=u=>l(o).customer=u),label:"Sold To (Customer Name)",variant:"outlined",density:"comfortable","prepend-inner-icon":"mdi-account","hide-details":"auto","error-messages":l(o).errors.customer},null,8,["modelValue","error-messages"]),s(S,null,{default:t(()=>[l(o).payment_method==="cash"&&l(o).cash_amount&&l(o).cash_amount>=_.value&&n.value.length>0?(m(),v(U,{key:0,type:"success",variant:"tonal",class:"mt-4",density:"compact"},{default:t(()=>[a("div",Te,[e[36]||(e[36]=a("span",{class:"font-weight-medium"},"Change:",-1)),a("span",Be," ₱"+p((Number(l(o).cash_amount)-_.value).toLocaleString()),1)])]),_:1})):b("",!0)]),_:1}),s(S,null,{default:t(()=>[l(o).payment_method==="Gcash"&&l(o).cash_amount&&l(o).cash_amount>=_.value&&n.value.length>0?(m(),v(U,{key:0,type:"success",variant:"tonal",class:"mt-4",density:"compact"},{default:t(()=>[a("div",Me,[s(r,{start:"",color:"success"},{default:t(()=>[...e[37]||(e[37]=[d("mdi-check-circle",-1)])]),_:1}),e[38]||(e[38]=a("span",{class:"font-weight-medium"},"GCash payment amount is correct",-1))])]),_:1})):b("",!0)]),_:1}),s(S,null,{default:t(()=>[l(o).cash_amount&&l(o).cash_amount<_.value?(m(),v(U,{key:0,type:"warning",variant:"tonal",class:"mt-4",density:"compact"},{default:t(()=>[a("div",Fe,[e[39]||(e[39]=a("span",{class:"font-weight-medium"},"Insufficient Amount:",-1)),a("span",Le," Need ₱"+p((_.value-Number(l(o).cash_amount)).toLocaleString())+" more ",1)])]),_:1})):b("",!0)]),_:1})]),s(z),a("div",De,[s(B,{dense:""},{default:t(()=>[s(j,{cols:"12",sm:"6"},{default:t(()=>[s(g,{block:"",size:"x-large",color:"indigo-darken-4",variant:"flat",onClick:O,disabled:A.value||l(o).processing,loading:l(o).processing,class:"pay-btn"},{default:t(()=>[s(r,{start:"",size:"24"},{default:t(()=>[...e[41]||(e[41]=[d("mdi-check-circle",-1)])]),_:1}),e[42]||(e[42]=a("span",{class:"text-h6 font-weight-bold"},"Process Payment",-1))]),_:1},8,["disabled","loading"])]),_:1}),s(j,{cols:"12",sm:"6"},{default:t(()=>[s(g,{block:"",size:"x-large",color:"grey-darken-2",variant:"outlined",onClick:W,disabled:l(o).processing,class:"cancel-btn"},{default:t(()=>[s(r,{start:"",size:"24"},{default:t(()=>[...e[43]||(e[43]=[d("mdi-close-circle",-1)])]),_:1}),e[44]||(e[44]=a("span",{class:"text-h6 font-weight-bold"},"Cancel",-1))]),_:1},8,["disabled"])]),_:1})]),_:1})])]),_:1})]),_:1})]),_:1})]),_:1})])}}},Je=ae(Ie,[["__scopeId","data-v-126b98ca"]]);export{Je as default};
