import{_ as Z,q as m,j as h,z as r,g as x,o as p,a as l,w as t,b as n,f as o,i as ee,t as c,d as te,c as w,A as N}from"./app-NUBUC0vD.js";import{a as O,f as le}from"./utility-C4IXQQAA.js";import{d as C}from"./dayjs.min-Do_9EaZr.js";const ae={class:"logs-wrapper"},oe={class:"page-header mb-8"},ne={class:"text-h4 font-weight-bold text-indigo-darken-4 mb-2"},se={class:"filters-section pa-6 pb-4"},re={class:"font-weight-bold text-indigo-darken-4"},ie={class:"d-flex align-center"},de={class:"text-body-2"},ue={key:0,class:"d-flex align-center"},me={class:"text-body-2"},pe={key:1,class:"text-medium-emphasis"},ce={class:"summary-row"},ve={class:"text-left font-weight-bold text-indigo-darken-4"},fe={class:"font-weight-bold text-indigo-darken-4"},_e={key:0,class:"load-more-section pa-6 text-center"},ke={class:"d-flex align-center"},ge={__name:"Index",props:{Tickets:{type:Array,default:()=>[]},filters:{type:Object,default:()=>({})}},setup(F){const T=F,d=m(I(T.Tickets)),A=m(T.Tickets.next_page_url),f=m(!1),D=m(null),k=m({label:"All",value:"All"}),Y=C().format("YYYY-MM-DD"),g=m(Y),b=m(Y),z=m("PARK-IN"),M=[{key:"ticket_no",title:"Ticket No",sortable:!0},{key:"plate_no",title:"Plate No"},{key:"park_datetime",title:"Park In",sortable:!0},{key:"park_out_datetime",title:"Park Out",sortable:!0},{key:"park_fee",title:"Park Fee",align:"center"},{key:"remarks",title:"Remarks",align:"center"},{key:"park_out_user.name",title:"Parked Out By",align:"center"},{key:"action",title:"Action",align:"center",sortable:!1}],U=[{label:"Park In Records",value:"PARK-IN"},{label:"Park Out Records",value:"PARK-OUT"}];function I(s){return console.log(s),(s||[]).map(e=>({...e,park_datetime:O(e.park_datetime),park_out_datetime:O(e.park_out_datetime)}))}const E=()=>{const s=new URLSearchParams({dateFrom:C(g.value).format("YYYY-MM-DD"),dateTo:C(b.value).format("YYYY-MM-DD"),staff:k.value.value||""}).toString();window.open(`${route("reports.parkout.preview")}?${s}`,"_blank")};function P({url:s="/logs",append:e=!1}={}){const i={dateFrom:g.value,dateTo:b.value,type:z.value,staff:k.value.value};N.get(s,i,{preserveState:!0,preserveScroll:!0,replace:!e,only:["Tickets","totalParkFee","filters"],onSuccess:_=>{const u=I(_.props.Tickets);e?d.value=[...d.value,...u]:d.value=u,A.value=_.props.Tickets.next_page_url}})}function $(){P({append:!1})}const B=h(()=>d.value.length?d.value.filter(s=>s.remarks==="Paid").reduce((s,e)=>s+Number(e.park_fee||0),0):0),L=s=>{D.value=s,f.value=!0},j=()=>{const s=D.value;d.value=d.value.map(e=>e.id===s?{...e,remarks:"VOIDED"}:e),N.delete(route("logs.delete",{id:s}),{onSuccess:()=>{f.value=!1,D.value=null,P({append:!1})},onError:e=>{console.error(e),P({append:!1})}})};return(s,e)=>{const i=r("v-icon"),_=r("v-date-input"),u=r("v-col"),S=r("v-select"),v=r("v-btn"),K=r("v-row"),y=r("v-divider"),V=r("v-chip"),q=r("v-data-table"),R=r("v-card"),G=r("v-container"),H=r("v-card-title"),J=r("v-alert"),Q=r("v-card-text"),W=r("v-card-actions"),X=r("v-dialog");return p(),x("div",ae,[l(G,{class:"py-8 px-6"},{default:t(()=>[n("div",oe,[n("div",null,[n("h1",ne,[l(i,{size:"32",class:"mr-2"},{default:t(()=>[...e[6]||(e[6]=[o("mdi-history",-1)])]),_:1}),e[7]||(e[7]=o(" Parking Logs ",-1))]),e[8]||(e[8]=n("p",{class:"text-body-1 text-medium-emphasis"}," Track and manage all parking transactions ",-1))])]),l(R,{class:"data-table-card elevation-8",rounded:"lg"},{default:t(()=>[n("div",se,[l(K,{align:"center"},{default:t(()=>[l(u,{cols:"12",md:"2"},{default:t(()=>[l(_,{modelValue:g.value,"onUpdate:modelValue":e[0]||(e[0]=a=>g.value=a),"prepend-icon":"",label:"From Date","prepend-inner-icon":"$calendar",density:"comfortable","hide-details":"auto",variant:"outlined","bg-color":"white"},null,8,["modelValue"])]),_:1}),l(u,{cols:"12",md:"2"},{default:t(()=>[l(_,{modelValue:b.value,"onUpdate:modelValue":e[1]||(e[1]=a=>b.value=a),"prepend-icon":"",label:"To Date","prepend-inner-icon":"$calendar",density:"comfortable","hide-details":"auto",variant:"outlined","bg-color":"white"},null,8,["modelValue"])]),_:1}),l(u,{cols:"12",md:"3"},{default:t(()=>[l(S,{label:"Staff",items:[{label:"All",value:"All"},...T.filters.staff.map(a=>({label:a.name,value:a.id}))],"item-title":"label","item-value":"value",modelValue:k.value.value,"onUpdate:modelValue":e[2]||(e[2]=a=>k.value.value=a),density:"comfortable","hide-details":"auto",variant:"outlined"},null,8,["items","modelValue"])]),_:1}),l(u,{cols:"12",md:"3"},{default:t(()=>[l(S,{label:"Log Type",items:U,"item-title":"label","item-value":"value",modelValue:z.value,"onUpdate:modelValue":e[3]||(e[3]=a=>z.value=a),density:"comfortable","hide-details":"auto",variant:"outlined","bg-color":"white","prepend-inner-icon":"mdi-filter"},null,8,["modelValue"])]),_:1}),l(u,{cols:"12",md:"2"},{default:t(()=>[l(v,{color:"indigo-darken-4",size:"large",block:"",onClick:$,"prepend-icon":"mdi-magnify"},{default:t(()=>[...e[9]||(e[9]=[o(" Search ",-1)])]),_:1})]),_:1})]),_:1})]),l(y),l(q,{headers:M,items:d.value,class:"custom-data-table","hide-default-footer":"","items-per-page":d.value.length},{"item.ticket_no":t(({item:a})=>[n("span",re,c(a.ticket_no),1)]),"item.plate_no":t(({item:a})=>[l(V,{color:"indigo-lighten-5",variant:"flat",size:"small",class:"font-weight-bold"},{default:t(()=>[o(c(a.plate_no),1)]),_:2},1024)]),"item.park_datetime":t(({item:a})=>[n("div",ie,[l(i,{size:"16",color:"success",class:"mr-2"},{default:t(()=>[...e[10]||(e[10]=[o("mdi-login",-1)])]),_:1}),n("span",de,c(a.park_datetime),1)])]),"item.park_out_datetime":t(({item:a})=>[a.park_out_datetime&&a.park_out_datetime!=="-"?(p(),x("div",ue,[l(i,{size:"16",color:"error",class:"mr-2"},{default:t(()=>[...e[11]||(e[11]=[o("mdi-logout",-1)])]),_:1}),n("span",me,c(a.park_out_datetime),1)])):(p(),w(V,{key:1,color:"success",variant:"flat",size:"small"},{default:t(()=>[l(i,{start:"",size:"12"},{default:t(()=>[...e[12]||(e[12]=[o("mdi-clock-outline",-1)])]),_:1}),e[13]||(e[13]=o(" Active ",-1))]),_:1}))]),"item.remarks":t(({item:a})=>[a.remarks?(p(),w(V,{key:0,color:a.remarks==="VOIDED"?"error":"info",variant:"flat",size:"small",class:"font-weight-medium"},{default:t(()=>[l(i,{start:"",size:"12"},{default:t(()=>[o(c(a.remarks==="VOIDED"?"mdi-close-circle":"mdi-information"),1)]),_:2},1024),o(" "+c(a.remarks),1)]),_:2},1032,["color"])):(p(),x("span",pe,"-"))]),"item.action":t(({item:a})=>[a.remarks!=="VOIDED"?(p(),w(v,{key:0,color:"error",size:"small",variant:"outlined",onClick:be=>L(a.id)},{default:t(()=>[l(i,{start:"",size:"18"},{default:t(()=>[...e[14]||(e[14]=[o("mdi-cancel",-1)])]),_:1}),e[15]||(e[15]=o(" Void ",-1))]),_:2},1032,["onClick"])):(p(),w(V,{key:1,color:"error",variant:"flat",size:"small",disabled:""},{default:t(()=>[...e[16]||(e[16]=[o(" Already Voided ",-1)])]),_:1}))]),"body.append":t(()=>[n("tr",ce,[n("td",ve,[l(i,{class:"mr-2"},{default:t(()=>[...e[17]||(e[17]=[o("mdi-calculator",-1)])]),_:1}),e[18]||(e[18]=o(" Total Summary: ",-1))]),e[20]||(e[20]=n("td",null,null,-1)),e[21]||(e[21]=n("td",null,null,-1)),e[22]||(e[22]=n("td",null,null,-1)),n("td",fe,c(te(le)(B.value)),1),e[23]||(e[23]=n("td",null,null,-1)),e[24]||(e[24]=n("td",null,null,-1)),n("td",null,[l(v,{variant:"text",color:"indigo-darken-4",size:"small","append-icon":"mdi-arrow-right",onClick:E},{default:t(()=>[...e[19]||(e[19]=[o(" View Report ",-1)])]),_:1})])])]),_:1},8,["items","items-per-page"]),A.value?(p(),x("div",_e,[l(y,{class:"mb-4"}),l(v,{color:"indigo-darken-4",size:"large",onClick:s.loadMore,variant:"outlined","prepend-icon":"mdi-refresh"},{default:t(()=>[...e[25]||(e[25]=[o(" Load More Records ",-1)])]),_:1},8,["onClick"])])):ee("",!0)]),_:1})]),_:1}),l(X,{modelValue:f.value,"onUpdate:modelValue":e[5]||(e[5]=a=>f.value=a),"max-width":"500",persistent:""},{default:t(()=>[l(R,{rounded:"lg"},{default:t(()=>[l(H,{class:"pa-6 pb-4"},{default:t(()=>[n("div",ke,[l(i,{size:"32",color:"error",class:"mr-3"},{default:t(()=>[...e[26]||(e[26]=[o("mdi-alert-circle",-1)])]),_:1}),e[27]||(e[27]=n("span",{class:"text-h6 font-weight-bold"},"Confirm Void Ticket",-1))])]),_:1}),l(y),l(Q,{class:"pa-6"},{default:t(()=>[l(J,{type:"warning",variant:"tonal",density:"comfortable"},{default:t(()=>[...e[28]||(e[28]=[o(" Are you sure you want to void this ticket? This action cannot be undone. ",-1)])]),_:1})]),_:1}),l(y),l(W,{class:"pa-4 justify-end"},{default:t(()=>[l(v,{variant:"outlined",onClick:e[4]||(e[4]=a=>f.value=!1)},{default:t(()=>[...e[29]||(e[29]=[o(" Cancel ",-1)])]),_:1}),l(v,{color:"error",variant:"flat",onClick:j},{default:t(()=>[...e[30]||(e[30]=[o(" Yes, Void Ticket ",-1)])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])])}}},we=Z(ge,[["__scopeId","data-v-dfe5cc31"]]);export{we as default};
